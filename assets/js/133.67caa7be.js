(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{587:function(a,t,e){"use strict";e.r(t);var s=e(42),r=Object(s.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"data-layer-in-tagmanager"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#data-layer-in-tagmanager"}},[a._v("#")]),a._v(" Data Layer in tagmanager")]),a._v(" "),e("p",[a._v("서버 데이터를 GA에서 쓰고 해석하기 쉽게 객체 형식으로 들고 있는 것.\n크롬 자바스크립트 콘솔에서 "),e("code",[a._v("dataLayer")]),a._v("라고 쳐보면 객체들이 나온다.")]),a._v(" "),e("ol",[e("li",[a._v("gtm.js: 구글 태그매니저가 로드되었을 때 불림")]),a._v(" "),e("li",[a._v("gtm.dom: 페이지 돔이 모두 로드되었을 때 불림")]),a._v(" "),e("li",[a._v("gtm.load: 모든 태그들까지 다 실행되었을 때 불림")])]),a._v(" "),e("h2",{attrs:{id:"사용법"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#사용법"}},[a._v("#")]),a._v(" 사용법")]),a._v(" "),e("h3",{attrs:{id:"데이터레이어-넣어주기"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#데이터레이어-넣어주기"}},[a._v("#")]),a._v(" 데이터레이어 넣어주기")]),a._v(" "),e("p",[a._v("젤 위에 dataLayer를 정의해준다.")]),a._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("script"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n  dataLayer "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("script"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),e("p",[a._v("GTM호출되기 전에 넣어주어야 한다. 안그러면 못 불림.")]),a._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("body"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("script"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n    dataLayer "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'pageCategory'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'signup'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n      "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'visitorType'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'high-value'")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("script"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v(" Google Tag Manager "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("...")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v(" End Google Tag Manager "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),e("p",[a._v("JS이벤트랑 같이 쓰려면")]),a._v(" "),e("div",{staticClass:"language-html extra-class"},[e("pre",{pre:!0,attrs:{class:"language-html"}},[e("code",[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("a")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("href")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("#"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("button1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("onclick")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("dataLayer.push({"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("'")]),a._v("event"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("'")]),a._v(": "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("'")]),a._v("button1-click"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("'")]),a._v("});"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("Button 1"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("a")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[a._v("태그매니저 접속해서 태그를 만든다.\n"),e("ul",[e("li",[a._v("Track Type: Transaction으로 잡고")]),a._v(" "),e("li",[a._v("new trigger를 만든다.\n"),e("ul",[e("li",[a._v("Transaction이란 이름으로")]),a._v(" "),e("li",[a._v("Custom Event로")]),a._v(" "),e("li",[a._v("Fire On에서 Event name을 데이터레이어에 박혀있는 이벤트 이름을 가져온다. (e.g. gtm4wp.orderCompleted)")])])])])])]),a._v(" "),e("h2",{attrs:{id:"의문"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#의문"}},[a._v("#")]),a._v(" 의문")]),a._v(" "),e("p",[a._v("impression이랑 detail모두 태그매니저에서 "),e("code",[a._v("pageview")]),a._v("가 일어날 때 불린다. 둘 다 이벤트가 gtm.dom일때 불리운다.\nimpression은 커스텀 자바스크립트로 돔을 긁어와서 dataLayer에 푸쉬해준다. 그래서 "),e("code",[a._v("$(window).load")]),a._v("등으로 감싸서 전달해주면 데이터레이어에 잘 전달되므로 태그매니저 프리뷰에는 보인다.\ndetail은 django template tag로 모델에서 바로 긁어온 데이터를 넣는거라 돔 위에 있어도 데이터를 가져올 수 있다.")]),a._v(" "),e("p",[a._v("비동기 문제인 듯 한데")]),a._v(" "),e("ol",[e("li",[a._v("GTM을 돔 로드 후에 넣으면\n"),e("ul",[e("li",[a._v("impression은 측정O.")]),a._v(" "),e("li",[a._v("detail view는 측정X. (태그매니저 프리뷰엔 보임)")]),a._v(" "),e("li",[a._v("카트 넣고 빼기 측정O.")])])]),a._v(" "),e("li",[a._v("GTM을 돔 로드 전에 넣으면 (공식 사이트 권고)\n"),e("ul",[e("li",[a._v("impression이 측정X. (태그매니저 프리뷰엔 보임)")]),a._v(" "),e("li",[a._v("detail view는 측정O.")]),a._v(" "),e("li",[a._v("카트 넣고 빼기 측정X. (태그매니저 프리뷰에도 안보임)")])])])]),a._v(" "),e("p",[a._v("태그매니저 프리뷰엔 보이면서 GA까진 전달이 되지 않는 걸 보면, pageview일때 안불려서 그렇거나 이벤트가 gtm.dom이 아니라서 전달이 되지 않는것일까. 혹은 데이터레이어랑 태그가 매치가 되어 있지 않을 수 있다.")]),a._v(" "),e("p",[a._v("detail view를 보면")]),a._v(" "),e("ol",[e("li",[a._v("message: [DL values after this msg] detail 들어옴")]),a._v(" "),e("li",[a._v("pageview: [DL values after this msg] ecommerce에 감싸진 detail 들어오고 밑에 gtm, event:'gtm.js'도 함께 들어간다.")]),a._v(" "),e("li",[a._v("DOM ready: [DL values after this msg] ecommerce에 감싸진 detail 들어오고 밑에 gtm, event:'gtm.dom'이 함께 들어간다. 이 때가 진짜인듯?")]),a._v(" "),e("li",[a._v("Message: [DL values after this msg] ecommerce에 detail밑에 impressions가 추가되어 들어오고 밑에 gtm, event:'gtm.dom'이 함께 들어간다. 이 때 두 개 다 잘 들어간 거 아닌가?! 아! 3번 돔 레디에서 이미 두개 다 들어가버렸구나!")])]),a._v(" "),e("p",[a._v("문제 알았다. DOM Ready에서 태그는 두 개 다 불리는데 그 당시 detail만 들어가 있다.")]),a._v(" "),e("h3",{attrs:{id:"해결"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#해결"}},[a._v("#")]),a._v(" 해결")]),a._v(" "),e("p",[a._v("디버깅은 차분히 GTM Preview로 한뎁스씩 클릭해보며 하자.")]),a._v(" "),e("h2",{attrs:{id:"refer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#refer"}},[a._v("#")]),a._v(" Refer")]),a._v(" "),e("p",[e("a",{attrs:{href:"https://youtu.be/NRb7wFAtExM",target:"_blank",rel:"noopener noreferrer"}},[a._v("Google Tag Manager course: The DataLayer [Preview]"),e("OutboundLink")],1),a._v(" "),e("a",{attrs:{href:"https://youtu.be/ZKjlIhFJMCU",target:"_blank",rel:"noopener noreferrer"}},[a._v("Google Tag Manager eCommerce Tracking installation explained"),e("OutboundLink")],1),a._v(" "),e("a",{attrs:{href:"http://www.simoahava.com/analytics/data-layer/",target:"_blank",rel:"noopener noreferrer"}},[a._v("The Data Layer"),e("OutboundLink")],1),a._v(" "),e("a",{attrs:{href:"http://www.simoahava.com/analytics/google-tag-manager-data-model/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Google Tag Manager’s Data Model"),e("OutboundLink")],1),a._v(" "),e("a",{attrs:{href:"https://developers.google.com/tag-manager/devguide",target:"_blank",rel:"noopener noreferrer"}},[a._v("Google Tag Manager for Web Tracking"),e("OutboundLink")],1),a._v(" "),e("a",{attrs:{href:"https://bluerivermountains.com/en/data-layer",target:"_blank",rel:"noopener noreferrer"}},[a._v("Data Layer explained with Tutorial [2020]"),e("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=r.exports}}]);